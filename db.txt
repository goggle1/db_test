[root@localhost ~]# mysql -h192.168.8.121 -udbs -pR4XBfuptAH corsair_0 

mysql> select count(*) from fs_media_stat;
+----------+
| count(*) |
+----------+
|    86879 | 
+----------+
1 row in set (0.00 sec)


mysql> select count(*) from fs_media_stat where playnum > 0;
+----------+
| count(*) |
+----------+
|    32085 | 
+----------+
1 row in set (0.02 sec)


mysql> select count(*) from fs_media_stat where web_daynum > 0;       
+----------+
| count(*) |
+----------+
|    12553 | 
+----------+
1 row in set (0.01 sec)



mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select * from fs_media_stat where web_daynum > 0" corsair_0 > 20130619.txt 
mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select * from fs_media_stat where web_daynum > 0 order by mediaid" corsair_0 > 20130619_mediaid.txt 


mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select * from fs_fsplay_stats where currentdate = 20130625 order by mediaid" corsair_0 > 0625.list 
mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select * from fs_fsplay_stats where currentdate = 20130624 order by mediaid" corsair_0 > 0624.list 
mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select * from fs_fsplay_stats where currentdate = 20130623 order by mediaid" corsair_0 > 0623.list 

[guoqiang@localhost data]$ wc -l 0626.list
19760 0626.list
[guoqiang@localhost data]$ wc -l 0625.list
19700 0625.list
[guoqiang@localhost data]$ wc -l 0624.list
19717 0624.list

awk '{print $2}' 0624.list > 0624.media
awk '{print $2}' 0625.list > 0625.media
awk '{print $2}' 0626.list > 0626.media

diff 0623.media 0624.media -c > 0624.diff
diff 0624.media 0625.media -c > 0625.diff
diff 0625.media 0626.media -c > 0626.diff

[guoqiang@localhost data]$ grep "^+\ " 0626.diff | wc -l
1058
[guoqiang@localhost data]$ grep "^-\ " 0626.diff | wc -l 
1000
[guoqiang@localhost data]$ grep "^\!\ " 0626.diff | wc -l  
368

[guoqiang@localhost data]$ crontab -l
40 10,11,17,18 * * * /home/guoqiang/data/db_yesterday.sh

mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select * from fs_fsplay_stats where currentdate = 20130625 order by mediaid" corsair_0 > 0625.list 
mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select * from fs_fsplay_stats where currentdate = 20130624 order by mediaid" corsair_0 > 0624.list 
mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select * from fs_fsplay_stats where currentdate = 20130623 order by mediaid" corsair_0 > 0623.list 

[guoqiang@localhost data]$ wc -l 0626.list
19760 0626.list
20130626，被点击的媒体id 19760个。
[guoqiang@localhost data]$ wc -l 0625.list
19700 0625.list
20130625，被点击的媒体id 19700个。
[guoqiang@localhost data]$ wc -l 0624.list
19717 0624.list
20130624，被点击的媒体id 19717个。

awk '{print $2}' 0624.list > 0624.media
awk '{print $2}' 0625.list > 0625.media
awk '{print $2}' 0626.list > 0626.media

diff 0623.media 0624.media -c > 0624.diff
diff 0624.media 0625.media -c > 0625.diff
diff 0625.media 0626.media -c > 0626.diff

[guoqiang@localhost data]$ grep "^+\ " 0626.diff | wc -l
1058
[guoqiang@localhost data]$ grep "^-\ " 0626.diff | wc -l 
1000
[guoqiang@localhost data]$ grep "^\!\ " 0626.diff | wc -l  
368
6月26日，比6月25日多播放了1058+368=1426个媒体id，少播放了1000+368=1368个媒体id。


服务器IP 192.168.8.196
服务端口3306
登录用户名public
登录密码 funshion
对macross库只读权限

/usr/bin/mysql -h192.168.8.196 -P3306 -upublic -pfunshion macross
mysql -h192.168.8.196 -P3306 -upublic -pfunshion macross

1.	现网有多少dat文件？或者说任务。
PC任务表为fs_task，移动任务表为fs_mobile_dat。其中state代表任务状态。

2.	现网有多少MediaServer？
可查看设备表fs_server，其中type_id=1表示设备类型为MS，is_valid=1表示设备处于激活状态。
现网共862台可用MS，其中PC主网200台，PC小运营商350台，移动平台312台。

3.	每天有多少新任务分发？
PC任务分发记录可查看fs_ms_task，移动任务分发记录可查看fs_mobile_ms_dat，其中start_time代表开始分发时间。

4.	MediaServer上面的每个任务，分别有多少点击量？
Macross没有相关数据。

Goob  14:40:31
根据media_id，从fs_media_serials这个表中，可以查到serialid;
根据serialid，从fs_dat_file这个表中，可以查到hashid；
根据hashid，从fs_task这个表中，可以查到task_id，可以查看任务的创建时间，分发时间要通过fs_ms_task表来查看。 （PC任务）
根据hashid, 从fs_mobile_dat中，可以查到task_id，可以查看任务的创建时间，分发时间通过fs_mobile_ms_dat表来查看。（移动任务）
Goob  14:41:32
对么？
那么，一个hashid，如何知道他是一个pc任务，还是一个移动任务呢？
李飞飞  14:42:39
嗯 你整理的是对的
从hash看不出是移动还是pc
只能分别去两个表里面查
Goob  14:43:24
两个表可能都有。

mysql> select * from fs_media_serials where media_id=105838;
+----------+----------+------------+----------+-----------------+---------------------+
| serialid | media_id | timelength | number   | description     | create_time         |
+----------+----------+------------+----------+-----------------+---------------------+
|   272452 |   105838 |            | 20121116 | 20121116??????? | 2013-01-06 17:09:57 | 
+----------+----------+------------+----------+-----------------+---------------------+
1 row in set (0.00 sec)

mysql> select * from fs_dat_file where serialid=272452;
+--------+----------+-----------------------+-----------+------------+---------+--------------------------------+-----+--------------+-------+-----------+------------------------------------------+------------+---------------------+-------------+----------+---------------------+----------+-------------+----------+-------------+---------------------+----------------+-----------------------+------+-----------+------------+-----------+-----------------------------------------+--------+------------+
| dat_id | serialid | dat_name              | file_size | timelength | clarity | files                          | bps | original_bps | piece | server_id | hashid                                   | uploader   | upload_time         | upload_desc | state    | upload_end_time     | priority | checker     | is_check | check_notes | check_time          | notify_corsair | edittaskname          | type | copyright | soundtrack | lang_type | files_new                               | is_new | source     |
+--------+----------+-----------------------+-----------+------------+---------+--------------------------------+-----+--------------+-------+-----------+------------------------------------------+------------+---------------------+-------------+----------+---------------------+----------+-------------+----------+-------------+---------------------+----------------+-----------------------+------+-----------+------------+-----------+-----------------------------------------+--------+------------+
| 333258 |   272452 | ??????-20121116       | 170269472 | 2747291    | dvd     | ??????-20121116.mp4::170269472 | 480 |           64 |   650 |      1388 | 4e8f3a6641dae7976ddcee1c429bc9af383fc8d6 | liuyang    | 2013-01-06 17:51:53 | NULL        | uploaded | 2013-01-07 14:46:57 | 20121116 | xuliangchao |        1 |             | 2013-01-07 14:47:03 |              1 | ??????-20121116       | pc   | NULL      |          0 | chi       | ??????-20121116.mp4::170269472::2747291 |      2 |            | 
| 470704 |   272452 | ??????-20121116-PHONE |  97517264 | 2747291    | tv      | ??????-20121116.mp4::97517264  | 320 |          320 |     0 |      1310 | 7b7a7d229825240468ebd10ca40ae85b4acc0477 | mobile_dat | 2013-03-28 06:22:02 | NULL        | uploaded | 2013-03-28 06:22:02 | 20121116 | mobile_dat  |        1 | NULL        | 2013-03-28 06:22:02 |              1 | ??????-20121116-PHONE | pc   |           |          0 | chi       | ??????-20121116.mp4::97517264::2747291  |      2 | mobile_dat | 
| 470706 |   272452 | ??????-20121116-PAD   | 170269472 | 2747291    | dvd     | ??????-20121116.mp4::170269472 | 480 |          480 |     0 |      1310 | 09f4b9a3732a22a60e78c8f8cb4ed421e869179f | mobile_dat | 2013-03-28 06:23:01 | NULL        | uploaded | 2013-03-28 06:23:01 | 20121116 | mobile_dat  |        1 | NULL        | 2013-03-28 06:23:01 |              1 | ??????-20121116-PAD   | pc   |           |          0 | chi       | ??????-20121116.mp4::170269472::2747291 |      2 | mobile_dat | 
+--------+----------+-----------------------+-----------+------------+---------+--------------------------------+-----+--------------+-------+-----------+------------------------------------------+------------+---------------------+-------------+----------+---------------------+----------+-------------+----------+-------------+---------------------+----------------+-----------------------+------+-----------+------------+-----------+-----------------------------------------+--------+------------+
3 rows in set (0.00 sec)

mysql> select * from fs_task where task_hash="4e8f3a6641dae7976ddcee1c429bc9af383fc8d6";
+---------+-----------+-------------+------------------------------------------+----------+-----------------+------+------------+----------+----------------+--------------+--------------+---------------+---------------+---------------------+---------------------+------------+---------------+------------------+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| task_id | type_code | user_name   | task_hash                                | media_id | task_name       | url  | state      | ms_peers | ms_upload_rate | tas_ls_peers | tas_ls_seeds | tas_ls3_peers | tas_ls3_seeds | create_time         | modify_time         | main_state | dispatch_time | ms_peers_history | ms_upload_rate_history | cluster_state                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
+---------+-----------+-------------+------------------------------------------+----------+-----------------+------+------------+----------+----------------+--------------+--------------+---------------+---------------+---------------------+---------------------+------------+---------------+------------------+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  338385 |         0 | xuliangchao | 4e8f3a6641dae7976ddcee1c429bc9af383fc8d6 |     NULL | ??????-20121116 |      | dispatched |        0 |              0 |            1 |            0 |             1 |             0 | 2013-01-07 14:47:03 | 2013-06-29 00:30:01 | dispatched | NULL          |                1 |                      0 | ;1:dispatched;2:dispatched;3:to-dispatch;4:to-dispatch;5:dispatched;6:dispatched;7:dispatched;8:dispatched;10:dispatched;11:dispatched;12:dispatched;13:dispatched;14:dispatched;15:dispatched;16:dispatched;17:dispatched;18:dispatched;19:dispatched;21:dispatched;22:dispatched;23:dispatched;24:dispatched;28:to-dispatch;29:dispatched;31:dispatched;32:dispatched;33:dispatched;34:dispatched;35:to-dispatch;36:dispatched;37:dispatched;40:dispatched;41:dispatched;43:dispatched;44:dispatched;45:dispatched;47:to-dispatch;48:to-dispatch;49:dispatched;50:dispatched;51:dispatched;52:dispatched;53:to-dispatch;54:to-dispatch;55:to-dispatch;56:to-dispatch;58:to-dispatch;59:to-dispatch;60:to-dispatch;61:to-dispatch;63:to-dispatch;64:to-dispatch;65:to-dispatch;66:to-dispatch;67:to-dispatch;68:to-dispatch; | 
+---------+-----------+-------------+------------------------------------------+----------+-----------------+------+------------+----------+----------------+--------------+--------------+---------------+---------------+---------------------+---------------------+------------+---------------+------------------+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (1.92 sec)

mysql> select * from fs_task where task_hash="7b7a7d229825240468ebd10ca40ae85b4acc0477";
+---------+-----------+------------+------------------------------------------+----------+-----------------------+------+------------+----------+----------------+--------------+--------------+---------------+---------------+---------------------+---------------------+------------+---------------+------------------+------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| task_id | type_code | user_name  | task_hash                                | media_id | task_name             | url  | state      | ms_peers | ms_upload_rate | tas_ls_peers | tas_ls_seeds | tas_ls3_peers | tas_ls3_seeds | create_time         | modify_time         | main_state | dispatch_time | ms_peers_history | ms_upload_rate_history | cluster_state                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+---------+-----------+------------+------------------------------------------+----------+-----------------------+------+------------+----------+----------------+--------------+--------------+---------------+---------------+---------------------+---------------------+------------+---------------+------------------+------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  500319 |      NULL | mobile_dat | 7b7a7d229825240468ebd10ca40ae85b4acc0477 |     NULL | ??????-20121116-PHONE | NULL | dispatched |        0 |              0 |            0 |            0 |             0 |             0 | 2013-03-28 06:22:02 | 2013-06-28 18:02:40 | dispatched | NULL          |                2 |                     47 | ;1:dispatched;2:to-dispatch;3:to-dispatch;4:to-dispatch;5:to-dispatch;6:to-dispatch;7:to-dispatch;8:to-dispatch;10:to-dispatch;11:to-dispatch;12:to-dispatch;13:to-dispatch;14:to-dispatch;15:to-dispatch;16:to-dispatch;17:to-dispatch;18:to-dispatch;19:to-dispatch;21:to-dispatch;22:to-dispatch;23:to-dispatch;24:to-dispatch;28:to-dispatch;29:to-dispatch;31:to-dispatch;32:to-dispatch;33:to-dispatch;34:to-dispatch;35:to-dispatch;36:to-dispatch;37:to-dispatch;40:to-dispatch;41:to-dispatch;43:to-dispatch;44:to-dispatch;45:to-dispatch;47:to-dispatch;48:to-dispatch;49:to-dispatch;50:to-dispatch;51:to-dispatch;52:dispatched;53:to-dispatch;54:to-dispatch;55:to-dispatch;56:to-dispatch;58:to-dispatch;59:to-dispatch;60:to-dispatch;61:to-dispatch;63:to-dispatch;64:to-dispatch;65:to-dispatch;66:to-dispatch;67:to-dispatch;68:to-dispatch; | 
+---------+-----------+------------+------------------------------------------+----------+-----------------------+------+------------+----------+----------------+--------------+--------------+---------------+---------------+---------------------+---------------------+------------+---------------+------------------+------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (3.31 sec)

mysql> select * from fs_task where task_hash="09f4b9a3732a22a60e78c8f8cb4ed421e869179f";
+---------+-----------+------------+------------------------------------------+----------+---------------------+------+------------+----------+----------------+--------------+--------------+---------------+---------------+---------------------+---------------------+------------+---------------+------------------+------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| task_id | type_code | user_name  | task_hash                                | media_id | task_name           | url  | state      | ms_peers | ms_upload_rate | tas_ls_peers | tas_ls_seeds | tas_ls3_peers | tas_ls3_seeds | create_time         | modify_time         | main_state | dispatch_time | ms_peers_history | ms_upload_rate_history | cluster_state                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+---------+-----------+------------+------------------------------------------+----------+---------------------+------+------------+----------+----------------+--------------+--------------+---------------+---------------+---------------------+---------------------+------------+---------------+------------------+------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  500321 |      NULL | mobile_dat | 09f4b9a3732a22a60e78c8f8cb4ed421e869179f |     NULL | ??????-20121116-PAD | NULL | dispatched |        0 |              0 |            0 |            0 |             0 |             0 | 2013-03-28 06:23:01 | 2013-06-28 09:10:55 | dispatched | NULL          |                1 |                      0 | ;1:dispatched;2:to-dispatch;3:to-dispatch;4:to-dispatch;5:to-dispatch;6:to-dispatch;7:to-dispatch;8:to-dispatch;10:to-dispatch;11:to-dispatch;12:to-dispatch;13:to-dispatch;14:to-dispatch;15:to-dispatch;16:to-dispatch;17:to-dispatch;18:to-dispatch;19:to-dispatch;21:to-dispatch;22:to-dispatch;23:to-dispatch;24:to-dispatch;28:to-dispatch;29:to-dispatch;31:to-dispatch;32:to-dispatch;33:to-dispatch;34:to-dispatch;35:to-dispatch;36:to-dispatch;37:to-dispatch;40:to-dispatch;41:to-dispatch;43:to-dispatch;44:to-dispatch;45:to-dispatch;47:to-dispatch;48:to-dispatch;49:to-dispatch;50:to-dispatch;51:to-dispatch;52:dispatched;53:to-dispatch;54:to-dispatch;55:to-dispatch;56:to-dispatch;58:to-dispatch;59:to-dispatch;60:to-dispatch;61:to-dispatch;63:to-dispatch;64:to-dispatch;65:to-dispatch;66:to-dispatch;67:to-dispatch;68:to-dispatch; | 
+---------+-----------+------------+------------------------------------------+----------+---------------------+------+------------+----------+----------------+--------------+--------------+---------------+---------------+---------------------+---------------------+------------+---------------+------------------+------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (2.97 sec)

mysql> select * from fs_ms_task where task_id=338385;
+---------------+---------+-----------+-------------+------------+---------------------+---------------------+-------------+-------------+
| msdispatch_id | task_id | server_id | user_name   | task_state | start_time          | end_time            | peer_number | upload_rate |
+---------------+---------+-----------+-------------+------------+---------------------+---------------------+-------------+-------------+
|      13422664 |  338385 |       304 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-07 14:53:40 |           1 |           0 | 
|      13422665 |  338385 |       308 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-07 14:58:22 |           1 |          32 | 
|      13422660 |  338385 |       473 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-07 14:58:58 |           0 |           0 | 
|      13422656 |  338385 |       494 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 16:36:53 |           1 |         120 | 
|      13422652 |  338385 |       540 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-09 03:05:32 |           1 |         232 | 
|      13422651 |  338385 |       542 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-31 13:10:20 |           5 |         397 | 
|      13422657 |  338385 |       579 | xuliangchao | running    | 2013-01-07 14:50:09 | 0000-00-00 00:00:00 |           0 |           0 | 
|      13422673 |  338385 |       591 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-29 17:01:03 |           0 |           0 | 
|      13429479 |  338385 |       600 | xuliangchao | running    | 2013-01-08 00:29:47 | 2013-01-08 17:27:47 |           1 |           0 | 
|      13422672 |  338385 |       640 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-07 14:52:51 |           1 |          24 | 
|      13422655 |  338385 |       667 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-07 15:52:54 |           1 |           0 | 
|      13422654 |  338385 |       688 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 16:52:04 |           1 |           0 | 
|      13429478 |  338385 |       719 | xuliangchao | running    | 2013-01-08 00:29:47 | 2013-01-09 18:37:42 |           0 |           0 | 
|      13422650 |  338385 |       735 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 18:06:17 |           1 |          59 | 
|      13422649 |  338385 |       740 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-07 14:52:50 |           0 |           0 | 
|      13422648 |  338385 |       805 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 23:30:20 |           1 |           0 | 
|      13429476 |  338385 |       817 | xuliangchao | running    | 2013-01-08 00:29:47 | 2013-01-08 17:19:37 |           1 |           0 | 
|      13422647 |  338385 |       830 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 18:33:40 |           0 |           0 | 
|      13422646 |  338385 |       842 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-09 03:49:23 |           0 |           0 | 
|      13422645 |  338385 |       864 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-05-23 20:13:33 |          10 |         241 | 
|      13422644 |  338385 |       871 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 21:40:55 |           0 |           0 | 
|      13422662 |  338385 |       879 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 17:43:54 |           1 |          88 | 
|      13422641 |  338385 |       923 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 17:14:09 |           1 |           0 | 
|      13422661 |  338385 |       924 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-09 07:08:24 |           1 |          96 | 
|      13422639 |  338385 |       948 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 17:49:29 |           1 |           0 | 
|      13422638 |  338385 |      1005 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-09 00:15:51 |           1 |           0 | 
|      13422637 |  338385 |      1012 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-09 03:53:23 |           1 |           0 | 
|      13422663 |  338385 |      1024 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 17:33:24 |           1 |          96 | 
|      13422636 |  338385 |      1086 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 16:10:49 |           0 |           0 | 
|      13422667 |  338385 |      1092 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-07 14:52:51 |           1 |           0 | 
|      13430467 |  338385 |      1147 | xuliangchao | running    | 2013-01-08 02:06:05 | 2013-01-08 16:39:48 |           1 |          96 | 
|      13422653 |  338385 |      1163 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 15:52:01 |           3 |           0 | 
|      13429477 |  338385 |      1165 | xuliangchao | running    | 2013-01-08 00:29:47 | 2013-01-08 16:57:03 |           0 |           0 | 
|      13422659 |  338385 |      1166 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 17:17:37 |           1 |          44 | 
|      13422668 |  338385 |      1206 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-07 14:52:51 |           1 |           8 | 
|      13422635 |  338385 |      1221 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-07 14:53:41 |           0 |           0 | 
|      13422658 |  338385 |      1248 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-09 00:27:17 |           1 |          96 | 
|      13422666 |  338385 |      1254 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-02-04 13:03:16 |           1 |           0 | 
|      13422674 |  338385 |      1315 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 16:48:14 |           1 |          64 | 
|      13422669 |  338385 |      1336 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-07 14:57:42 |           1 |         144 | 
|      13422634 |  338385 |      1343 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 00:20:47 |           1 |          96 | 
|      13422633 |  338385 |      1380 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-08 18:15:09 |           1 |         306 | 
|      13422640 |  338385 |      1389 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-10 02:50:08 |           1 |           0 | 
|      13430466 |  338385 |      1392 | xuliangchao | running    | 2013-01-08 02:06:05 | 2013-01-09 14:53:07 |           1 |           0 | 
|      13422670 |  338385 |      1399 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-07 14:54:10 |           1 |         312 | 
|      13422671 |  338385 |      1405 | xuliangchao | running    | 2013-01-07 14:50:09 | 2013-01-07 14:52:49 |           1 |           0 | 
+---------------+---------+-----------+-------------+------------+---------------------+---------------------+-------------+-------------+
46 rows in set (0.00 sec)

mysql> select * from fs_ms_task where task_id=500319;
+---------------+---------+-----------+-----------+------------+---------------------+---------------------+-------------+-------------+
| msdispatch_id | task_id | server_id | user_name | task_state | start_time          | end_time            | peer_number | upload_rate |
+---------------+---------+-----------+-----------+------------+---------------------+---------------------+-------------+-------------+
|      17119199 |  500319 |      1405 | script    | running    | 2013-03-28 06:50:37 | 2013-03-28 06:52:21 |           0 |           0 | 
|      17119198 |  500319 |      1402 | script    | running    | 2013-03-28 06:50:37 | 2013-03-28 06:51:51 |           0 |           0 | 
|      17119197 |  500319 |      1354 | script    | running    | 2013-03-28 06:50:37 | 2013-03-28 06:51:57 |           1 |           0 | 
|      17119196 |  500319 |      1284 | script    | running    | 2013-03-28 06:50:37 | 2013-03-28 06:51:52 |           1 |           0 | 
|      17119195 |  500319 |      1208 | script    | running    | 2013-03-28 06:50:37 | 2013-03-28 06:52:25 |           0 |           0 | 
|      17119194 |  500319 |      1181 | script    | running    | 2013-03-28 06:50:37 | 2013-03-28 06:52:02 |           0 |           0 | 
|      17119193 |  500319 |       698 | script    | running    | 2013-03-28 06:50:37 | 2013-04-08 23:29:01 |           0 |           0 | 
|      17119192 |  500319 |      1393 | script    | running    | 2013-03-28 06:50:37 | 2013-06-18 06:06:06 |           0 |           0 | 
|      18886168 |  500319 |      1381 | baosw     | running    | 2013-04-06 23:16:13 | 2013-04-06 23:18:58 |           0 |           0 | 
+---------------+---------+-----------+-----------+------------+---------------------+---------------------+-------------+-------------+
9 rows in set (0.65 sec)

mysql> select * from fs_ms_task where task_id=500321;
+---------------+---------+-----------+-----------+------------+---------------------+---------------------+-------------+-------------+
| msdispatch_id | task_id | server_id | user_name | task_state | start_time          | end_time            | peer_number | upload_rate |
+---------------+---------+-----------+-----------+------------+---------------------+---------------------+-------------+-------------+
|      17119183 |  500321 |      1403 | script    | running    | 2013-03-28 06:50:37 | 2013-03-28 06:52:20 |           0 |           0 | 
|      17119182 |  500321 |      1397 | script    | running    | 2013-03-28 06:50:37 | 2013-03-28 06:51:40 |           0 |           0 | 
|      17119181 |  500321 |      1335 | script    | running    | 2013-03-28 06:50:37 | 2013-03-28 06:51:49 |           0 |           0 | 
|      17119180 |  500321 |      1279 | script    | running    | 2013-03-28 06:50:37 | 2013-03-28 06:51:25 |           0 |           0 | 
|      17119179 |  500321 |      1250 | script    | running    | 2013-03-28 06:50:37 | 2013-03-28 06:51:34 |           1 |           0 | 
|      17119178 |  500321 |      1211 | script    | running    | 2013-03-28 06:50:37 | 2013-03-28 06:52:23 |           0 |           0 | 
|      17119177 |  500321 |      1181 | script    | running    | 2013-03-28 06:50:37 | 2013-03-28 06:52:59 |           0 |           0 | 
|      17119176 |  500321 |       700 | script    | running    | 2013-03-28 06:50:37 | 2013-04-10 23:38:43 |           0 |           0 | 
|      18043145 |  500321 |      1380 | baosw     | running    | 2013-04-02 22:14:50 | 2013-04-03 04:52:43 |           0 |           0 | 
+---------------+---------+-----------+-----------+------------+---------------------+---------------------+-------------+-------------+
9 rows in set (0.75 sec)

mysql> select * from fs_mobile_dat where dat_hash="4e8f3a6641dae7976ddcee1c429bc9af383fc8d6";    
Empty set (0.07 sec)

mysql> select * from fs_mobile_dat where dat_hash="7b7a7d229825240468ebd10ca40ae85b4acc0477"; 
+---------+----------+-----------+----------------------------------+------------------------------------------+-----------------------+----------+------------+-------------------------------+----------+---------+------------------+-------+-----------+------------+----------------+------------+----------+----------------+---------+---------------------+---------------------+---------------+--------------+-----------+----------------------------------------+--------+------------+
| dat_id  | serialid | user_name | cid                              | dat_hash                                 | dat_name              | filesize | timelength | files                         | subtitle | bitrate | original_bitrate | piece | copyright | soundtrack | notify_corsair | state      | ms_peers | ms_upload_rate | clarity | create_time         | modify_time         | dispatch_time | notify_tuner | lang_type | files_new                              | is_new | convert_pc |
+---------+----------+-----------+----------------------------------+------------------------------------------+-----------------------+----------+------------+-------------------------------+----------+---------+------------------+-------+-----------+------------+----------------+------------+----------+----------------+---------+---------------------+---------------------+---------------+--------------+-----------+----------------------------------------+--------+------------+
| 1110756 |   272452 | liuyang   | 8b45c54996e4a5d0004202b1d0cff6d7 | 7b7a7d229825240468ebd10ca40ae85b4acc0477 | ??????-20121116-PHONE | 97517264 | 2747291    | ??????-20121116.mp4::97517264 | NULL     |     320 |                0 |     0 | NULL      |          0 |              1 | dispatched |        0 |              0 | tv      | 2013-01-06 17:53:14 | 2013-06-28 18:07:34 | NULL          |            1 | chi       | ??????-20121116.mp4::97517264::2747291 |      2 |          1 | 
+---------+----------+-----------+----------------------------------+------------------------------------------+-----------------------+----------+------------+-------------------------------+----------+---------+------------------+-------+-----------+------------+----------------+------------+----------+----------------+---------+---------------------+---------------------+---------------+--------------+-----------+----------------------------------------+--------+------------+
1 row in set (0.08 sec)

mysql> select * from fs_mobile_dat where dat_hash="09f4b9a3732a22a60e78c8f8cb4ed421e869179f"; 
+---------+----------+-----------+----------------------------------+------------------------------------------+---------------------+-----------+------------+--------------------------------+----------+---------+------------------+-------+-----------+------------+----------------+------------+----------+----------------+---------+---------------------+---------------------+---------------+--------------+-----------+-----------------------------------------+--------+------------+
| dat_id  | serialid | user_name | cid                              | dat_hash                                 | dat_name            | filesize  | timelength | files                          | subtitle | bitrate | original_bitrate | piece | copyright | soundtrack | notify_corsair | state      | ms_peers | ms_upload_rate | clarity | create_time         | modify_time         | dispatch_time | notify_tuner | lang_type | files_new                               | is_new | convert_pc |
+---------+----------+-----------+----------------------------------+------------------------------------------+---------------------+-----------+------------+--------------------------------+----------+---------+------------------+-------+-----------+------------+----------------+------------+----------+----------------+---------+---------------------+---------------------+---------------+--------------+-----------+-----------------------------------------+--------+------------+
| 1110753 |   272452 | liuyang   | 8b45c54996e4a5d0004202b1d0cff6d7 | 09f4b9a3732a22a60e78c8f8cb4ed421e869179f | ??????-20121116-PAD | 170269472 | 2747291    | ??????-20121116.mp4::170269472 | NULL     |     480 |                0 |     0 | NULL      |          0 |              1 | dispatched |        0 |              0 | dvd     | 2013-01-06 17:52:40 | 2013-06-28 06:27:41 | NULL          |            1 | chi       | ??????-20121116.mp4::170269472::2747291 |      2 |          1 | 
+---------+----------+-----------+----------------------------------+------------------------------------------+---------------------+-----------+------------+--------------------------------+----------+---------+------------------+-------+-----------+------------+----------------+------------+----------+----------------+---------+---------------------+---------------------+---------------+--------------+-----------+-----------------------------------------+--------+------------+
1 row in set (1.92 sec)

mysql> select * from fs_mobile_ms_dat  where dat_id=1110756;
+-------------+-----------+---------+-----------+---------+---------------------+---------------------+-------------+-------------+
| dispatch_id | server_id | dat_id  | user_name | state   | start_time          | end_time            | peer_number | upload_rate |
+-------------+-----------+---------+-----------+---------+---------------------+---------------------+-------------+-------------+
|    21639190 |      1263 | 1110756 | script    | running | 2013-04-13 07:49:18 | 2013-04-13 11:14:49 |           1 |      116830 | 
|    13833301 |      1074 | 1110756 | script    | running | 2013-01-07 08:56:31 | 2013-01-07 10:47:10 |           1 |          62 | 
|    13833302 |      1117 | 1110756 | script    | running | 2013-01-07 08:56:31 | 2013-01-07 10:47:10 |           1 |       39290 | 
|    13833303 |      1126 | 1110756 | script    | running | 2013-01-07 08:56:31 | 2013-01-07 10:47:10 |           1 |          29 | 
|    13833306 |      1160 | 1110756 | script    | running | 2013-01-07 08:56:31 | 2013-01-07 10:47:10 |           1 |          17 | 
|    13833309 |      1240 | 1110756 | script    | running | 2013-01-07 08:56:31 | 2013-01-07 10:47:10 |           0 |           0 | 
|    13833311 |      1298 | 1110756 | script    | running | 2013-01-07 08:56:31 | 2013-01-07 10:47:10 |           1 |           0 | 
|    13833312 |      1460 | 1110756 | script    | running | 2013-02-01 11:44:59 | 2013-02-01 15:48:24 |           0 |           0 | 
|    13833313 |      1329 | 1110756 | script    | running | 2013-01-07 08:56:31 | 2013-01-07 10:47:10 |           1 |          62 | 
|    13833314 |      1351 | 1110756 | script    | running | 2013-01-07 08:56:31 | 2013-01-07 10:47:10 |           1 |           0 | 
|    13833315 |      1356 | 1110756 | script    | running | 2013-01-07 08:56:31 | 2013-01-07 10:47:10 |           1 |         200 | 
|    13833316 |      1365 | 1110756 | script    | running | 2013-01-07 08:56:31 | 2013-01-07 09:21:52 |           1 |          30 | 
|    13833317 |      1374 | 1110756 | script    | running | 2013-01-07 08:56:31 | 2013-01-07 10:47:10 |           1 |          92 | 
|    13833318 |      1478 | 1110756 | script    | running | 2013-03-02 20:15:12 | 2013-06-27 17:51:54 |           0 |           0 | 
|    14496153 |      1426 | 1110756 | script    | running | 2013-01-17 08:21:20 | 2013-01-17 15:27:43 |           0 |           0 | 
|    14932870 |      1436 | 1110756 | script    | running | 2013-01-18 15:56:28 | 2013-01-18 19:12:37 |           1 |          39 | 
|    15428137 |      1456 | 1110756 | script    | running | 2013-01-23 12:43:30 | 2013-01-24 05:55:26 |           0 |           0 | 
|    17125128 |      1464 | 1110756 | script    | running | 2013-03-03 23:39:29 | 2013-03-04 03:45:07 |           1 |           0 | 
|    18096543 |      1489 | 1110756 | script    | running | 2013-03-12 18:58:29 | 2013-03-13 03:01:40 |           1 |          80 | 
|    19735529 |      1516 | 1110756 | script    | running | 2013-03-29 05:49:26 | 2013-03-29 09:03:50 |           0 |           0 | 
|    23433637 |      1564 | 1110756 | script    | running | 2013-04-28 00:44:39 | 2013-04-28 01:53:50 |           1 |          39 | 
|    26324772 |      1656 | 1110756 | script    | running | 2013-05-18 13:35:12 | 2013-05-24 15:51:07 |          22 |         410 | 
|    28649536 |      1717 | 1110756 | script    | running | 2013-06-10 02:39:23 | 2013-06-13 18:36:30 |           0 |           0 | 
+-------------+-----------+---------+-----------+---------+---------------------+---------------------+-------------+-------------+
23 rows in set (0.00 sec)

mysql> select * from fs_mobile_ms_dat  where dat_id=1110753;
+-------------+-----------+---------+-----------+---------+---------------------+---------------------+-------------+-------------+
| dispatch_id | server_id | dat_id  | user_name | state   | start_time          | end_time            | peer_number | upload_rate |
+-------------+-----------+---------+-----------+---------+---------------------+---------------------+-------------+-------------+
|    21639187 |      1540 | 1110753 | script    | running | 2013-04-13 07:49:14 | 2013-04-13 08:30:46 |           5 |          42 | 
|    13832483 |       932 | 1110753 | script    | running | 2013-01-07 08:55:14 | 2013-01-07 10:06:05 |           5 |    -1372628 | 
|    13832484 |      1073 | 1110753 | script    | running | 2013-01-07 08:55:14 | 2013-01-07 10:06:05 |           5 |         339 | 
|    13832485 |      1115 | 1110753 | script    | running | 2013-01-07 08:55:14 | 2013-01-07 10:06:05 |           0 |           0 | 
|    13832486 |      1125 | 1110753 | script    | running | 2013-01-07 08:55:14 | 2013-01-07 10:06:05 |           0 |           0 | 
|    13832492 |      1240 | 1110753 | script    | running | 2013-01-07 08:55:14 | 2013-01-07 10:06:05 |           5 |         129 | 
|    13832494 |      1303 | 1110753 | script    | running | 2013-01-07 08:55:14 | 2013-01-07 10:06:05 |           0 |           0 | 
|    13832495 |      1307 | 1110753 | script    | running | 2013-01-07 08:55:14 | 2013-01-07 10:06:05 |           1 |         200 | 
|    13832496 |      1329 | 1110753 | script    | running | 2013-01-07 08:55:14 | 2013-01-07 10:06:05 |           0 |           0 | 
|    13832497 |      1350 | 1110753 | script    | running | 2013-01-07 08:55:14 | 2013-01-07 10:06:05 |           4 |         131 | 
|    13832498 |      1357 | 1110753 | script    | running | 2013-01-07 08:55:14 | 2013-01-07 10:06:05 |           0 |           0 | 
|    13832499 |      1359 | 1110753 | script    | running | 2013-01-07 08:55:14 | 2013-01-07 09:28:50 |           2 |         221 | 
|    13832500 |      1370 | 1110753 | script    | running | 2013-01-07 08:55:14 | 2013-01-07 10:06:05 |           1 |          80 | 
|    13832501 |      1475 | 1110753 | script    | running | 2013-03-03 03:31:45 | 2013-06-28 06:27:41 |           0 |           0 | 
|    14496150 |      1431 | 1110753 | script    | running | 2013-01-17 08:21:18 | 0000-00-00 00:00:00 |           5 |           0 | 
|    14932867 |      1443 | 1110753 | script    | running | 2013-01-18 15:56:26 | 2013-01-18 18:37:56 |           0 |           0 | 
|    15428134 |      1453 | 1110753 | script    | running | 2013-01-23 12:43:30 | 2013-01-24 05:29:51 |           0 |           0 | 
|    17125125 |      1471 | 1110753 | script    | running | 2013-03-03 23:39:27 | 2013-03-04 03:45:07 |           0 |           0 | 
|    18096540 |      1496 | 1110753 | script    | running | 2013-03-12 18:58:25 | 2013-03-13 03:01:40 |           1 |           0 | 
|    19735526 |      1513 | 1110753 | script    | running | 2013-03-29 05:49:26 | 2013-03-29 09:54:24 |           0 |           0 | 
|    23433634 |      1571 | 1110753 | script    | running | 2013-04-28 00:44:39 | 2013-04-28 03:42:54 |           1 |          28 | 
|    26324769 |      1653 | 1110753 | script    | running | 2013-05-18 13:35:09 | 2013-05-27 13:28:09 |           0 |           0 | 
|    28649533 |      1714 | 1110753 | script    | running | 2013-06-10 02:39:23 | 2013-06-17 05:02:42 |           0 |           0 | 
+-------------+-----------+---------+-----------+---------+---------------------+---------------------+-------------+-------------+
23 rows in set (0.00 sec)

select end_time from (
  select end_time from fs_ms_task where task_id in (
    select task_id from (
    	select task_id from fs_task where task_hash in (
      	select hashid from (
      		select hashid from fs_dat_file where serialid in (
        		select serialid from (
        			select serialid from fs_media_serials where media_id=105838
        		)as tb1
      		) 
      	) as tb2
    	) 
    ) as tb3
  ) and end_time != '0000-00-00' order by end_time asc limit 1
) as tb5
where end_time between '2013-01-01' and '2013-06-26';

select end_time from (
  select end_time from fs_ms_task where task_id in (
    select task_id from (
    	select task_id from fs_task where task_hash in (
      	select hashid from (
      		select hashid from fs_dat_file where serialid in (
        		select serialid from (
        			select serialid from fs_media_serials where media_id=${MEDIA_ID}
        		)as tb1
      		) 
      	) as tb2
    	) 
    ) as tb3
  ) and end_time != '0000-00-00' order by end_time asc limit 1
) as tb5
where end_time between '${BEGIN_TIME}' and '${BEGIN_TIME}';

mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select * from fs_fsplay_stats where currentdate = 20130701 order by num desc" corsair_0 > 0701.list

mysql -h192.168.8.196 -P3306 -upublic -pfunshion --default-character-set=utf8 -e"select * from fs_base_ip order by begin_ip asc" macross > ip_group.txt

CREATE TABLE hashid_playnum(
    hash_id VARCHAR(40),
    area_id int,
    play_num_pc bigint,
    play_num_mobile bigint,
    start_time timestamp null
);

1step@gh

服务器IP 192.168.8.101
服务端口 3317
登录用户名 public
登录密码 funshion
对 macross 库只读权限

mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select mediaid from fs_fsplay_stats where currentdate > 20130101 group by mediaid order by mediaid" corsair_0 > mediaid_play_20130101.list 
mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select mediaid from fs_media_stat group by mediaid order by mediaid" corsair_0 > mediaid_all.list 
mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select mediaid from fs_media group by mediaid order by mediaid" corsair_0 > mediaid_all_2.list 
mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select distinct(mediaid) from fs_media_stat order by mediaid" corsair_0 > mediaid_all_3.list 

select mediaid from fs_fsplay_stats where currentdate > 20130101 group by mediaid order by mediaid;

select mediaid from fs_media_stat group by mediaid order by mediaid;
select distinct(mediaid) from fs_media_stat order by mediaid


mysql -h192.168.8.101 -P3317 -upublic -pfunshion  macross

mysql> select count(*) from fs_task;
+----------+
| count(*) |
+----------+
|  1025072 |
+----------+
1 row in set (0.00 sec)

mysql> select count(*) from fs_task where state = 'dispatch-failed' or state = 'dispatched' or state = 'dispatching';
+----------+
| count(*) |
+----------+
|   976932 |
+----------+
1 row in set (0.44 sec)

mysql> select count(*) from fs_mobile_dat;
+----------+
| count(*) |
+----------+
|  1479706 |
+----------+
1 row in set (0.01 sec)

mysql> select count(*) from fs_mobile_dat where state = 'dispatch-failed' or state = 'dispatched' or state = 'dispatching';
+----------+
| count(*) |
+----------+
|  1300239 |
+----------+
1 row in set (1.23 sec)

select * from fs_mobile_dat where filesize > 4294967296;

mysql> select sum(file_size) from fs_dat_file;
+------------------+
| sum(file_size)   |
+------------------+
| 6451978280448643 |
+------------------+
1 row in set (7.14 sec)

mysql> select sum(filesize) from fs_mobile_dat;
+-----------------+
| sum(filesize)   |
+-----------------+
| 202605488872318 |
+-----------------+
1 row in set (1.29 sec)

mysql> select sum(filesize) from fs_mobile_dat where state = 'dispatch-failed' or state = 'dispatched' or state = 'dispatching';
+-----------------+
| sum(filesize)   |
+-----------------+
| 181145348879982 |
+-----------------+
1 row in set (1.57 sec)

mysql> select sum(file_size) from fs_task as task left join fs_dat_file as df on task.task_hash = df.hashid where task.state = 'dispatch-failed' or task.state = 'dispatched' or task.state = 'dispatching'; 
+-----------------+
| sum(file_size)  |
+-----------------+
| 137898167756931 |
+-----------------+
1 row in set (1 min 11.27 sec)

mysql> select sum(file_size) from fs_dat_file where file_size <= 4294967296;  
+-----------------+
| sum(file_size)  |
+-----------------+
| 157343012565932 |
+-----------------+
1 row in set (0.89 sec)

mysql> select sum(file_size) from fs_dat_file where file_size > 4294967296;  
+------------------+
| sum(file_size)   |
+------------------+
| 6294639625661398 |
+------------------+
1 row in set (0.82 sec)

mysql> select hashid, file_size/1024/1024/1024 from fs_dat_file where file_size > 4294967296;
+------------------------------------------+--------------------------+
| hashid                                   | file_size/1024/1024/1024 |
+------------------------------------------+--------------------------+
| 005002600E94B4FF6A229AB3DFE28D1A7CB0AB44 |      479232.000000000000 |
| 3DD6DBAAD9E08C3894A531972BDBAC40971A92D2 |           5.880861313082 |
| 77B84F7027BA0BCBF5D8C8A856D37F16D504A5BE |           4.791090213694 |
... ...

服务器IP 192.168.8.101
服务端口 3317
登录用户名 public
登录密码 funshion
对 macross 库只读权限

mysql macross -h192.168.8.101 -P3317 -upublic -pfunshion -e"select task_hash, create_time from fs_task where state = 'dispatch-failed' or state = 'dispatched' or state = 'dispatching' order by create_time"> pc_task.list 
mysql macross -h192.168.8.101 -P3317 -upublic -pfunshion -e"select task_hash, create_time+0 from fs_task where state = 'dispatch-failed' or state = 'dispatched' or state = 'dispatching' order by create_time"> pc_task.list 

select task_hash from fs_task where state = 'dispatch-failed' or state = 'dispatched' or state = 'dispatching';

1：pc任务根据mediaid查询hashid
         SELECT hashid FROM fs_dat_file d,fs_media_serials s WHERE d.serialid=s.`serialid` AND s.`media_id`=$media_id

2：移动任务根据mediaid查询hashid
         SELECT dat_hash FROM fs_mobile_dat d,fs_media_serials s WHERE d.serialid=s.`serialid` AND s.`media_id`=$media_id

3：pc任务根据32位cid查询hashid
 
4：移动任务根据32位cid查询hashid
     SELECT dat_hash FROM fs_mobile_dat WHERE cid='{$cid}'

5：PC平台的某个MediaServer上的infohash列表
     SELECT task_hash FROM fs_task t,fs_ms_task m WHERE t.task_id = m.task_id AND m.server_id=$server_id

6：移动平台的某个MediaServer上的infohash列表
     SELECT dat_hash FROM fs_mobile_dat d,fs_mobile_ms_dat m WHERE d.dat_id = m.dat_id AND m.server_id=$server_id

7：PC平台的某个机房内的infohash列表
  SELECT task_hash FROM fs_task t,fs_ms_task m,fs_server s WHERE t.task_id = m.task_id AND m.server_id=s.server_id AND s.is_valid=1 AND s.room_id=$room_id

8：移动平台的某个机房内的infohash列表
     SELECT dat_hash FROM fs_mobile_dat t,  fs_mobile_ms_dat  m,fs_server s WHERE t.dat_id = m.dat_id  AND m.server_id=s.server_id AND s.is_valid=1 AND s.room_id=$room_id

纠正一下第八个：
8：移动平台的某个机房内的infohash列表
     SELECT dat_hash FROM fs_mobile_dat t,  fs_mobile_ms_dat  m,fs_server s WHERE t.dat_id = m.dat_id  AND m.server_id=s.server_id AND s.is_valid=1 AND s.ml_room_id=$room_id

cat hashid_cold.sh

#!/bin/bash
DATE=20130701
mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select mediaid from fs_fsplay_stats where currentdate > ${DATE} group by mediaid order by mediaid" corsair_0 > mediaid_${DATE}.list
mysql -h192.168.8.121 -udbs -pR4XBfuptAH -e"select distinct(mediaid) from fs_media_stat order by mediaid" corsair_0 > mediaid_all_${DATE}.list 
diff mediaid_all_${DATE}.list mediaid_${DATE}.list -c > mediaid_diff_${DATE}.list
grep "^\-\ " mediaid_diff_${DATE}.list > mediaid_cold_${DATE}.list

function do_line()
{
        PREFIX=$1
        MEDIA_ID=$2

        mysql macross -h192.168.8.101 -P3317 -upublic -pfunshion -e"SELECT hashid FROM fs_dat_file d,fs_media_serials s WHERE d.serialid=s.\`serialid\` AND s.\`media_id\`=${MEDIA_ID}" >> hashid_cold_${DATE}.temp 
}

>hashid_cold_${DATE}.temp

while read line
do
        do_line ${line}
done < mediaid_cold_${DATE}.list

grep -v "hashid" hashid_cold_${DATE}.temp > hashid_cold_${DATE}.list

select count(*), sum(filesize) from fs_video_dat where create_time >= "2013-07-30 00:00:00" and create_time < "2013-07-31 00:00:00" and (state = 'dispatch-failed' or state = 'dispatched' or state = 'dispatching') ;
select count(*), sum(filesize) from fs_mobile_dat where create_time >= "2013-07-30 00:00:00" and create_time < "2013-07-31 00:00:00" and (state = 'dispatch-failed' or state = 'dispatched' or state = 'dispatching') ;
SELECT count(*), sum(d.file_size) FROM fs_dat_file d, fs_task t  WHERE t.create_time >= "2013-07-30 00:00:00" AND t.create_time < "2013-07-31 00:00:00"   AND (t.state = 'dispatch-failed' OR t.state = 'dispatched' OR t.state = 'dispatching')  AND d.hashid=t.task_hash;

SELECT media_id FROM fs_task t WHERE t.create_time >= "2013-07-01 00:00:00" and t.create_time < "2013-07-02 00:00:00" and (t.state = 'dispatch-failed' or t.state = 'dispatched' or t.state = 'dispatching');
SELECT count(*), sum(d.file_size) FROM fs_dat_file d, fs_media_serials s, (SELECT media_id FROM fs_task t WHERE t.create_time >= "2013-07-01 00:00:00" and t.create_time < "2013-07-02 00:00:00" and (t.state = 'dispatch-failed' or t.state = 'dispatched' or t.state = 'dispatching')) t WHERE d.serialid=s.`serialid` AND s.`media_id`=t.`media_id`;

mysql> select count(*), sum(filesize) from fs_video_dat where create_time >= "2013-07-30 00:00:00" and create_time < "2013-07-31 00:00:00" and (state = 'dispatch-failed' or state = 'dispatched' or state = 'dispatching') ;
+----------+---------------+
| count(*) | sum(filesize) |
+----------+---------------+
|      213 |   85737332804 |
+----------+---------------+
1 row in set (0.35 sec)

mysql> select count(*), sum(filesize) from fs_mobile_dat where create_time >= "2013-07-30 00:00:00" and create_time < "2013-07-31 00:00:00" and (state = 'dispatch-failed' or state = 'dispatched' or state = 'dispatching') ;
+----------+---------------+
| count(*) | sum(filesize) |
+----------+---------------+
|     1716 |  209527279790 |
+----------+---------------+
1 row in set (1.76 sec)

mysql> SELECT count(*), sum(d.file_size) FROM fs_dat_file d, fs_task t  WHERE t.create_time >= "2013-07-30 00:00:00" AND t.create_time < "2013-07-31 00:00:00"   AND (t.state = 'dispatch-failed' OR t.state = 'dispatched' OR t.state = 'dispatching')  AND d.hashid=t.task_hash;
+----------+------------------+
| count(*) | sum(d.file_size) |
+----------+------------------+
|     1510 |     176143874955 |
+----------+------------------+
1 row in set (27.38 sec)

select hashid, file_size from fs_dat_file where serialid in
(
	select serialid from
	(
		select serialid from fs_media_serials where media_id in
		(
			select media_id from 
			(	SELECT media_id FROM fs_task WHERE create_time >= "2013-07-01 00:00:00" and create_time < "2013-07-02 00:00:00" and (state = 'dispatch-failed' or state = 'dispatched' or state = 'dispatching')	) 
			as tb1
		)
	) as tb2
)

#!/bin/bash

FILE_NAME=$1
IP_QUERY_PREFIX="http://192.168.160.202:4321/iprocess/?cmd=ipquery&ip="

function do_line()
{
        LINE=$1
        CLIENT_IP=`echo "$LINE" | awk -F"," '{print $2}'`
        HASH_ID=`echo "$LINE" | awk -F"," '{print $7}'`
        MS_IP=`echo "$LINE" | awk -F"," '{print $8}'`
        
        HASH_ID_UPPER=`echo $HASH_ID|tr [a-z] [A-Z]`
        
        IP_QUERY_URL="${IP_QUERY_PREFIX}${CLIENT_IP}"
        RESULT=`curl -s "${IP_QUERY_URL}" `
        AREA=`echo $RESULT|awk -F"[\r=,]" '{print $4}'`
        ISP=`echo $RESULT|awk -F"[\r=,]" '{print $5}'`
        
        HASH_ID_LEN=`expr length "$HASH_ID_UPPER"`
        if [ $HASH_ID_LEN -eq 32 -o $HASH_ID_LEN -eq 40 ]; 
        then
        	echo "$CLIENT_IP,$AREA,$ISP,$HASH_ID_UPPER,$MS_IP"
        fi
}

while read line
do
        do_line $line
done < ${FILE_NAME}

查询磁盘空间小于100G的磁盘的ms列表，分pc移动，需要显示机房名称，以及相关的ms信息。
fs_ms_realstate
fs_server
Goob  17:35:20
如何区分PC平台的，还是移动平台的？
平台-陈佳佳  17:36:43
room_id不为空的就是pc平台
ml_room_id不为空的是移动的
Goob  17:38:13
下一个问题是：room_id是机房ID吧？机房名称在哪个表里可以查到？
平台-陈佳佳  17:39:10
fs_server_location

select * from fs_ms_realstate where free_disk < 100 order by server_id;
select a.*, b.room_id, b.ml_room_id from fs_ms_realstate a, fs_server b where a.free_disk < 100 and a.server_id=b.server_id order by a.server_id;
select a.*, b.room_id, b.ml_room_id, c.room_name from fs_ms_realstate a, fs_server b, fs_server_location c where a.free_disk < 100 and a.server_id=b.server_id and (b.room_id=c.room_id or b.ml_room_id=c.room_id) order by a.server_id;


select * from fs_mobile_dat where create_time >= "2013-07-30 00:00:00" and create_time < "2013-07-31 00:00:00" and (state = 'dispatch-failed' or state = 'dispatched' or state = 'dispatching') 

select a.*, b.room_id, b.ml_room_id, c.room_name from fs_ms_realstate a, fs_server b, fs_server_location c where a.server_id=b.server_id and (b.room_id=c.room_id or b.ml_room_id=c.room_id) order by a.server_id;