http://jsonfe.funshion.com/?cli=ipad&ver=2.0.0.0&ta=&sid=&src=media&page=1&pagesize=100

1. get media_id
105394
... 

2. get serial_id newest
mysql -h192.168.8.101 -P3317 -upublic -pfunshion  macross
根据 media_id，从 fs_media_serials 这个表中，可以查到serialid;

mysql> select * from fs_media_serials where media_id = 105394;
+----------+----------+------------+--------+-----------------+---------------------+
| serialid | media_id | timelength | number | description     | create_time         |
+----------+----------+------------+--------+-----------------+---------------------+
|   330735 |   105394 |            |      1 | 疯狂原始人      | 2013-07-04 10:57:25 |
+----------+----------+------------+--------+-----------------+---------------------+
1 row in set (0.03 sec)

3. get task_id
  
根据 hashid, 从 fs_mobile_dat 中，可以查到 task_id,

mysql> select * from fs_mobile_dat where serialid = 330735;
+---------+----------+-----------+----------------------------------+------------------------------------------+-----------------------+-----------+------------+--------------------------------+----------+---------+------------------+-------+-----------+------------+----------------+------------+----------+----------------+----------+---------------------+---------------------+---------------+--------------+-----------+-----------------------------------------+--------+------------+--------------+---------+
| dat_id  | serialid | user_name | cid                              | dat_hash                                 | dat_name              | filesize  | timelength | files                          | subtitle | bitrate | original_bitrate | piece | copyright | soundtrack | notify_corsair | state      | ms_peers | ms_upload_rate | clarity  | create_time         | modify_time         | dispatch_time | notify_tuner | lang_type | files_new                               | is_new | convert_pc | compare_mark | profile |
+---------+----------+-----------+----------------------------------+------------------------------------------+-----------------------+-----------+------------+--------------------------------+----------+---------+------------------+-------+-----------+------------+----------------+------------+----------+----------------+----------+---------------------+---------------------+---------------+--------------+-----------+-----------------------------------------+--------+------------+--------------+---------+
| 1484624 |   330735 | linda     | 872b800b7a3d0597c62a6f9e572e0f4e | 0A9F5C0EB02A53165E618E1BB0C1CF4AFC036527 | 疯狂原始人-PAD        | 456081293 | 0          |                                | NULL     |     480 |                0 |     0 | NULL      |          0 |              1 | dispatched |     2628 |         100856 | dvd      | 2013-07-04 13:28:38 | 2013-08-05 16:07:28 | NULL          |            1 | und       |                                         |      0 |          0 |          297 |         |
| 1484628 |   330735 | linda     | 872b800b7a3d0597c62a6f9e572e0f4e | 389984F50FE069C79C6740B7CD11075CB5CBB583 | 疯狂原始人-PAD        | 407862622 | 5872930    | 疯狂原始人.mp4::407862622      | NULL     |     480 |                0 |     0 | NULL      |          0 |              1 | dispatched |      102 |           5908 | dvd      | 2013-07-04 13:29:38 | 2013-08-05 16:07:28 | NULL          |            1 | und       | 疯狂原始人.mp4::407862622::5872930      |      4 |          1 |          297 | main    |
| 1484629 |   330735 | linda     | 872b800b7a3d0597c62a6f9e572e0f4e | 8A09493642F1F9A6081182F9C77DA2FF2E3FD9B7 | 疯狂原始人-PHONE      | 246159946 | 0          |                                | NULL     |     320 |                0 |     0 | NULL      |          0 |              1 | dispatched |      585 |          21193 | tv       | 2013-07-04 13:30:38 | 2013-08-05 16:07:28 | NULL          |            1 | und       |                                         |      0 |          0 |          297 |         |
| 1484630 |   330735 | linda     | 872b800b7a3d0597c62a6f9e572e0f4e | 5D5E0B23FA39CB97E659F64640FDF09618565935 | 疯狂原始人-PHONE      | 208496776 | 5872930    | 疯狂原始人.mp4::208496776      | NULL     |     320 |                0 |     0 | NULL      |          0 |              1 | dispatched |     1529 |         126784 | tv       | 2013-07-04 13:30:59 | 2013-08-05 16:07:28 | NULL          |            1 | und       | 疯狂原始人.mp4::208496776::5872930      |      0 |          1 |          297 |         |
| 1484637 |   330735 | linda     | 872b800b7a3d0597c62a6f9e572e0f4e | AE56EAC142F385DB5AC2DE42CBD2D5A7AC9AD372 | 疯狂原始人-HDPAD      | 630063637 | 0          |                                | NULL     |     720 |                0 |     0 | NULL      |          0 |              1 | dispatched |       24 |           1871 | high-dvd | 2013-07-04 13:32:48 | 2013-08-05 16:07:28 | NULL          |            1 | und       |                                         |      0 |          0 |          297 |         |
| 1484643 |   330735 | linda     | 872b800b7a3d0597c62a6f9e572e0f4e | C65F1F0DC18AA5A5B58EB6CC598DBA720F1FFB58 | 疯狂原始人-HDPAD      | 588474088 | 5872953    | 疯狂原始人.mp4::588474088      | NULL     |     720 |                0 |     0 | NULL      |          0 |              1 | dispatched |      100 |          14660 | high-dvd | 2013-07-04 13:33:48 | 2013-08-05 16:07:28 | NULL          |            1 | und       | 疯狂原始人.mp4::588474088::5872953      |      0 |          0 |          297 |         |
+---------+----------+-----------+----------------------------------+------------------------------------------+-----------------------+-----------+------------+--------------------------------+----------+---------+------------------+-------+-----------+------------+----------------+------------+----------+----------------+----------+---------------------+---------------------+---------------+--------------+-----------+-----------------------------------------+--------+------------+--------------+---------+
6 rows in set (0.01 sec)

mysql> select * from fs_mobile_ms_dat where dat_id=1484624;
+-------------+-----------+---------+-----------+---------+---------------------+---------------------+-------------+-------------+
| dispatch_id | server_id | dat_id  | user_name | state   | start_time          | end_time            | peer_number | upload_rate |
+-------------+-----------+---------+-----------+---------+---------------------+---------------------+-------------+-------------+
|    30965954 |      1483 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 22:15:47 |           1 |           0 |
|    30965953 |      1474 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          36 |        1875 |
|    30965949 |      1439 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          69 |        3004 |
|    30965947 |      1372 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          11 |         346 |
|    30965948 |      1426 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          78 |        3057 |
|    30965950 |      1449 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          92 |        4996 |
|    30965951 |      1459 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |         209 |        4669 |
|    30965945 |      1325 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |         142 |        4498 |
|    30965940 |      1120 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |         118 |        6855 |
|    30965937 |       935 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |         270 |       10294 |
|    30965936 |       931 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          54 |        2531 |
|    30965952 |      1466 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |         241 |        6448 |
|    30965963 |      1623 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |           3 |         857 |
|    30965966 |      1779 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-31 04:43:18 |          10 |         735 |
|    30965965 |      1713 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |         116 |        6069 |
|    30965964 |      1672 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-31 04:43:18 |           1 |         594 |
|    30965942 |      1236 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          82 |        3703 |
|    30965946 |      1352 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          87 |        3306 |
|    30965943 |      1242 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          93 |        2530 |
|    30965938 |       955 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |         177 |        7755 |
|    30965941 |      1138 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          60 |        3295 |
|    30965939 |      1045 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |         306 |       10390 |
|    30965944 |      1300 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          43 |        2053 |
|    30965957 |      1518 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-26 21:42:06 |           1 |           0 |
|    30965955 |      1494 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          69 |        2898 |
|    30965956 |      1514 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          51 |        2996 |
|    30965962 |      1617 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-05 00:20:08 |           2 |           0 |
|    30965958 |      1540 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |         137 |        6204 |
|    30965960 |      1579 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |         270 |        6992 |
|    30965959 |      1564 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          88 |        3310 |
|    30965961 |      1607 | 1484624 | script    | running | 2013-07-04 13:54:11 | 2013-07-04 14:25:51 |          19 |        1359 |
|    33235984 |      1212 | 1484624 | script    | running | 2013-07-31 14:08:27 | 2013-07-31 14:36:48 |           1 |           0 |
+-------------+-----------+---------+-----------+---------+---------------------+---------------------+-------------+-------------+
32 rows in set (0.16 sec)


mysql> select * from fs_server where server_id=1483;
+-----------+---------+---------+-------------+--------------+-------------+--------------+---------------+-----------+----------+------------+------------------+------------------+----------+-------------+----------+---------------------+-------------+----------+------------+-----------+----------+---------------+------------+----------+------------+
| server_id | room_id | type_id | server_name | server_ip    | server_port | controll_ip  | controll_port | user_name | password | secret_key | server_version   | protocol_version | tas_type | description | is_valid | time                | is_dispatch | disk_num | total_size | free_rate | min_free | machine_model | ml_room_id | is_pause | lv_room_id |
+-----------+---------+---------+-------------+--------------+-------------+--------------+---------------+-----------+----------+------------+------------------+------------------+----------+-------------+----------+---------------------+-------------+----------+------------+-----------+----------+---------------+------------+----------+------------+
|      1483 |    NULL |       1 | JSYD-04     | 112.25.26.97 |          80 | 112.25.26.97 |          6261 | NULL      | NULL     | NULL       | 2.3.1.05CentOS5. | 2.1              | NULL     |             |        1 | 2013-02-28 15:11:33 |           1 |       11 |      20171 |         0 |       30 |               |         33 |        0 |          0 |
+-----------+---------+---------+-------------+--------------+-------------+--------------+---------------+-----------+----------+------------+------------------+------------------+----------+-------------+----------+---------------------+-------------+----------+------------+-----------+----------+---------------+------------+----------+------------+
1 row in set (0.01 sec)


获取所有的机房列表。

1. 获取到MS列表
server_id

mysql -h192.168.8.101 -P3317 -upublic -pfunshion  --default-character-set=utf8 macross -e	\
"select a.*, b.room_id, b.ml_room_id, b.server_name, b.server_ip, b.server_port, c.room_name from fs_ms_realstate a, fs_server b, fs_server_location c where a.server_id=b.server_id and (b.room_id=c.room_id or b.ml_room_id=c.room_id) order by a.server_id" \
> ms.list

2. 获取异常的MS列表
mysql -h192.168.8.101 -P3317 -upublic -pfunshion  --default-character-set=utf8 macross -e	\
"select server_id, count(*) from fs_mobile_ms_dat where state='dispatching' group by server_id order by count(*) DESC " \
>  dispathing.list

mysql -h192.168.8.101 -P3317 -upublic -pfunshion  --default-character-set=utf8 macross -e	\	
"select server_id, count(*) from fs_mobile_ms_dat where state='dispatch-failed' group by server_id order by count(*) DESC " \
>  dispatch_failed.list
